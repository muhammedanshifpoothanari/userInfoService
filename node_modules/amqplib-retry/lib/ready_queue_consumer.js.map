{"version":3,"sources":["../src/ready_queue_consumer.js"],"names":[],"mappings":"wpBAAA,GAAM,QAAS,QAAQ,UAAR,CAAf,CACA,GAAM,SAAU,QAAQ,UAAR,CAAhB,C,GAEM,mB,YACJ,4BAAa,OAAb,CAAsB,0CACpB,KAAK,OAAL,CAAe,OAChB,C,oEAEQ,CACP,GAAM,MAAO,IAAb,CACA,MAAO,MAAK,OAAL,CAAa,OAAb,CAAqB,OAAO,cAA5B,CAA4C,SAAC,GAAD,QACjD,SACG,GADH,CACO,UAAM,CACT,GAAM,iBAAkB,IAAI,UAAJ,CAAe,OAAf,CAAuB,YAA/C,CACA,GAAM,YAAa,IAAI,UAAJ,CAAe,OAAf,CAAuB,mBAA1C,CACA,MAAO,MAAK,OAAL,CAAa,WAAb,CAAyB,eAAzB,CAA0C,GAAI,OAAJ,CAAW,IAAI,OAAf,CAA1C,CAAmE,UAAnE,CACR,CALH,EAMG,IANH,CAMQ,iBAAM,MAAK,OAAL,CAAa,GAAb,CAAiB,GAAjB,CAAN,CANR,EAOG,KAPH,CAOS,SAAC,GAAD,CAAS,CACd,QAAQ,KAAR,CAAc,kEAAoE,GAApE,CAA0E,SAA1E,CAAsF,KAAK,SAAL,CAAe,GAAf,CAApG,EACA,KAAK,OAAL,CAAa,IAAb,CAAkB,GAAlB,CACD,CAVH,CADiD,CAA5C,CAaR,C,iCAGH,OAAO,OAAP,CAAiB,kBAAjB","file":"ready_queue_consumer.js","sourcesContent":["const config = require('./config')\nconst Promise = require('bluebird')\n\nclass ReadyQueueConsumer {\n  constructor (channel) {\n    this.channel = channel\n  }\n\n  start () {\n    const self = this\n    return self.channel.consume(config.readyQueueName, (msg) =>\n      Promise\n        .try(() => {\n          const targetQueueName = msg.properties.headers._targetQueue\n          const properties = msg.properties.headers._originalProperties\n          return self.channel.sendToQueue(targetQueueName, new Buffer(msg.content), properties)\n        })\n        .then(() => self.channel.ack(msg))\n        .catch((err) => {\n          console.error('Error: while trying to process message from ready queue.  err: ' + err + ', msg: ' + JSON.stringify(msg))\n          self.channel.nack(msg)\n        })\n    )\n  }\n}\n\nmodule.exports = ReadyQueueConsumer\n"]}